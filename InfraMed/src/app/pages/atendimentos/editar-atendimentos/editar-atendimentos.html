<div class="container">
  <h2>Editar Atendimento</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="paciente" class="form-label">Paciente *</label>
          <select class="form-select" id="paciente" formControlName="paciente">
            <option value="">Selecione um paciente</option>
            <option *ngFor="let paciente of pacientes" [ngValue]="paciente">{{paciente.nome}}</option>
          </select>
          <div *ngIf="form.get('paciente')?.invalid && form.get('paciente')?.touched" class="text-danger">
            Paciente é obrigatório.
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="medicoResponsavel" class="form-label">Médico Responsável *</label>
          <select class="form-select" id="medicoResponsavel" formControlName="medicoResponsavel">
            <option value="">Selecione um médico</option>
            <option *ngFor="let medico of medicos" [ngValue]="medico">{{medico.nome}}</option>
          </select>
          <div *ngIf="form.get('medicoResponsavel')?.invalid && form.get('medicoResponsavel')?.touched"
            class="text-danger">
            Médico responsável é obrigatório.
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="medicoComplicacao" class="form-label">Médico de Complicação</label>
          <select class="form-select" id="medicoComplicacao" formControlName="medicoComplicacao">
            <option value="">Selecione um médico</option>
            <option *ngFor="let medico of medicos" [ngValue]="medico">{{medico.nome}}</option>
          </select>
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="statusPaciente" class="form-label">Status do Paciente *</label>
          <select class="form-select" id="statusPaciente" formControlName="statusPaciente">
            <option value="">Selecione o status</option>
            <option *ngFor="let status of statusPacientes" [ngValue]="status">{{status}}</option>
          </select>
          <div *ngIf="form.get('statusPaciente')?.invalid && form.get('statusPaciente')?.touched" class="text-danger">
            Status do paciente é obrigatório.
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="acompanhante" class="form-label">Acompanhante</label>
          <input type="text" class="form-control" id="acompanhante" formControlName="acompanhante">
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="statusMonitoramento" class="form-label">Status de Monitoramento</label>
          <select class="form-select" id="statusMonitoramento" formControlName="statusMonitoramento">
            <option value="">Selecione o status</option>
            <option *ngFor="let status of statusMonitoramentos" [ngValue]="status">{{status}}</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="mb-3">
          <label for="condicoesPreexistentes" class="form-label">Condições Pré-existentes</label>
          <textarea class="form-control" id="condicoesPreexistentes" rows="3"
            formControlName="condicoesPreexistentes"></textarea>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="diagnostico" class="form-label">Diagnóstico</label>
          <select class="form-select" id="diagnostico" formControlName="diagnostico">
            <option value="">Selecione um diagnóstico</option>
            <option *ngFor="let diag of diagnosticos" [ngValue]="diag.key">{{diag.key}}</option>
          </select>
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="diagnosticoComplicacao" class="form-label">Diagnóstico de Complicação</label>
          <select class="form-select" id="diagnosticoComplicacao" formControlName="diagnosticoComplicacao">
            <option value="">Selecione um diagnóstico</option>
            <option *ngFor="let diag of diagnosticos" [ngValue]="diag.key">{{diag.key}}</option>
          </select>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="mb-3">
          <label for="tratamento" class="form-label">Tratamento</label>
          <textarea class="form-control" id="tratamento" rows="3" formControlName="tratamento"></textarea>
        </div>
      </div>
      <div class="col-md-6">
        <div class="mb-3">
          <label for="tratamentoComplicacao" class="form-label">Tratamento de Complicação</label>
          <textarea class="form-control" id="tratamentoComplicacao" rows="3"
            formControlName="tratamentoComplicacao"></textarea>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="mb-3">
          <label for="observacoes" class="form-label">Observações</label>
          <textarea class="form-control" id="observacoes" rows="3" formControlName="observacoes"></textarea>
        </div>
      </div>
    </div>

    <div *ngIf="error" class="alert alert-danger">{{error}}</div>

    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-secondary me-2" (click)="cancelar()">Cancelar</button>
      <button type="submit" class="btn btn-primary" [disabled]="loading || form.invalid">
        {{loading ? 'Atualizando...' : 'Atualizar Atendimento'}}
      </button>
    </div>
  </form>
</div>